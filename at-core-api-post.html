<link rel="import" href="../tangere/tangere.html">
<link rel="import" href="../at-core-activity/at-core-activity.html">
<link rel="import" href="../at-core-modal/at-core-modal.html">


<dom-module id="at-core-api-post">
  <template>
    <style>
      :host {
        display: inline;
        box-sizing: border-box;
      }
    </style>
    <at-core-activity id="post" on-response="_dataResponse" on-discard="_handleRequestDiscard" on-error="_handleRequestError"></at-core-activity>
    <at-core-modal id="dialog"></at-core-modal> 
  </template>
</dom-module>

<script>
  Polymer({
    is: 'at-core-api-post',
    properties: {
      url: {
        type: String,
        value: ""
      },
      busy: {
        type: Boolean,
        value: false
      }
    },

    ready: function () {

    },
    attached: function () {

    },

    detached: function () {

    },

    post: function (data) {

      if (this.busy) {
        alert("Currently busy. Try again in a moment.");
        return;
      }

      this.busy = true;
     
      this.$.post.method = "POST";
      this.$.post.url = this.url + "/" + data.args.atAgentAction;
      this.$.post.indicator = true;
      this.$.post.contentType = "application/json";
      this.$.post.body = data;
      this.$.post.generateRequest();

    },

    _dataResponse: function (e) {
      // usually handled by Tangere.behaviors.actionhandler     
      this.fire("api-response", e.detail);
      this.busy = false;
    },

    _handleRequestDiscard: function (e) {
      this.busy = false;
    },

    _handleRequestError: function (e) {
      this.busy = false;
    }

  });
</script>
